<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Watch movies and TV shows online free">
  <meta property="og:type" content="video.movie">
  <title>Watch - Cine Realm</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

</head>
<body>
<div id="appIntro">
  <div class="intro-logo">CineRealm</div>
</div>

<div id="loadingSpinner" class="loading-spinner" style="display:none;">
  <div class="spinner"></div>
  <p>Loading...</p>
</div>

<header>
  <div class="header-left">
    <h1><a href="/" style="color:#ff2c2c;text-decoration:none;">üé¨ Cine Realm</a></h1>
  </div>
  <input type="text" id="searchBar" placeholder="Search movies or shows..." autocomplete="off">
<nav class="nav-links">
  <a href="/" class="nav-btn">Home</a>
  <a href="/movies" class="nav-btn">Movies</a>
  <a href="/trending" class="nav-btn">Trending</a>
  <a href="/watchlist" class="nav-btn">Watchlist</a>
  <a href="/search" class="nav-btn">Search</a>
</nav>


</header>

<main id="watchContainer" class="watch-container">
<div id="player">
  <div id="player-season-dropdown"></div>
  <div id="player-tabs-placeholder"></div>
  <div id="player-iframe-placeholder" class="iframe-placeholder"></div>
</div>

  

  
  <div id="watchInfo" class="watch-info"></div>
  
  <div id="seasonSelector" class="season-selector" style="display:none;"></div>
  
  <section>
    <h2>You May Also Like</h2>
    <div id="recommendations" class="movie-row"></div>
  </section>
</main>

<div id="detailsModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <div id="detailsBody"></div>
  </div>
</div>

<script src="/script.js"></script>
<script>
  function setSeo({ title, overview, image, type }) {
    document.title = title ? `${title} - Cine Realm` : "Watch - Cine Realm";

    const desc = (overview || "Watch movies and TV shows online.").slice(0, 155);

    // description
    let metaDesc = document.querySelector('meta[name="description"]');
    if (!metaDesc) {
      metaDesc = document.createElement("meta");
      metaDesc.setAttribute("name", "description");
      document.head.appendChild(metaDesc);
    }
    metaDesc.setAttribute("content", desc);

    // canonical
    let canonical = document.querySelector('link[rel="canonical"]');
    if (!canonical) {
      canonical = document.createElement("link");
      canonical.setAttribute("rel", "canonical");
      document.head.appendChild(canonical);
    }
    canonical.setAttribute("href", window.location.href);

    // OG basics
    const og = (prop, val) => {
      let tag = document.querySelector(`meta[property="${prop}"]`);
      if (!tag) {
        tag = document.createElement("meta");
        tag.setAttribute("property", prop);
        document.head.appendChild(tag);
      }
      tag.setAttribute("content", val);
    };

    og("og:title", title ? `${title} - Cine Realm` : "Watch - Cine Realm");
    og("og:description", desc);
    og("og:type", type === "tv" ? "video.tv_show" : "video.movie");
    if (image) og("og:image", image);
  }

  function parseWatchPath(pathname) {
    // Supports:
    // /watch/movie/123
    // /watch/tv/123
    // /watch/tv/123/season/1/episode/1
    const parts = pathname.replace(/\/+$/, "").split("/"); // trim trailing slash
    // ["", "watch", "tv", "123", "season", "1", "episode", "1"]
    if (parts[1] !== "watch") return null;

    const type = parts[2];
    const id = parseInt(parts[3], 10);

    let season = null, episode = null;
    const seasonIndex = parts.indexOf("season");
    const episodeIndex = parts.indexOf("episode");
    if (seasonIndex !== -1) season = parseInt(parts[seasonIndex + 1], 10);
    if (episodeIndex !== -1) episode = parseInt(parts[episodeIndex + 1], 10);

    if (!type || !id || Number.isNaN(id)) return null;
    return { type, id, season, episode };
  }

  function go(url, { replace = false } = {}) {
    if (replace) history.replaceState({}, "", url);
    else history.pushState({}, "", url);
  }
function switchPage(page) {
  currentPage = page;

  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));

  const pageEl = document.getElementById(page + "Page");
  if (pageEl) pageEl.classList.add("active");

  document.querySelectorAll(".nav-btn").forEach(btn => btn.classList.remove("active"));

  const btnEl = document.getElementById(page + "Btn");
  if (btnEl) btnEl.classList.add("active");

  if (playerDiv) playerDiv.innerHTML = "";
  window.scrollTo(0, 0);
}

  async function loadFromUrl({ replace = false } = {}) {
    const parsed = parseWatchPath(window.location.pathname);
    if (!parsed) {
      console.error("Invalid watch URL:", window.location.pathname);
      return;
    }

    const { type, id, season, episode } = parsed;

    // Auto-redirect TV short route -> S1E1
    if (type === "tv" && (!season || !episode)) {
      const target = `/watch/tv/${id}/season/1/episode/1`;
      go(target, { replace: true });
      return loadFromUrl({ replace: true });
    }

    // init saved data
    loadHistory();
    loadWatchlist();

    // fetch details (your apiCall already exists in script.js)
    const data = await apiCall(`/${type}/${id}`);
    const title = data?.title || data?.name || "";
    const overview = data?.overview || "";
    const img = data?.poster_path ? `https://image.tmdb.org/t/p/w500${data.poster_path}` : "";

    setSeo({ title, overview, image: img, type });

    // Load your existing player
    // If your loadPlayer supports tv season/episode, pass them (safe even if ignored)
   loadPlayer(id, type, title, {
  season: season || 1,
  episode: episode || 1
});

  }

  // Back/forward button support
  window.addEventListener("popstate", () => {
    loadFromUrl({ replace: true });
  });

  // Initial load
  loadFromUrl();
</script>

<div id="disclaimerModal" class="disclaimer-modal" style="display:none;">
  <div class="disclaimer-box">
    <h2>‚ö†Ô∏è Disclaimer</h2>
    <p>
      CineRealm does not host or control any media streams.
      Some third-party sources may contain ads or pop-ups that are outside of our control.
    </p>
    <p>
      By continuing, you acknowledge that all content is provided by external sources and
      CineRealm is not responsible for third-party behavior.
    </p>

    <label class="dontshow">
      <input type="checkbox" id="dontShowAgain">
      Don‚Äôt show again
    </label>

    <div class="disc-actions">
      <button id="acceptDisclaimer">Accept & Continue</button>
      <button id="cancelDisclaimer" class="disc-secondary">Cancel</button>
    </div>
  </div>
</div>

<div id="appIntro" class="intro hidden">
  <div class="intro-logo">CineRealm</div>
</div>

</body>
</html>
